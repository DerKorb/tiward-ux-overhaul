(function(){"use strict";function fe(I){return I&&I.__esModule&&Object.prototype.hasOwnProperty.call(I,"default")?I.default:I}function oe(I){throw new Error('Could not dynamically require "'+I+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var se={},ie={},ue;function he(){return ue||(ue=1,function(I){(function(r){r.createMatrix=function(t,a,f){for(var S=new Array(t),k=0;k<t;k++)S[k]=new Array(a),f!==void 0&&S[k].fill(f);return S.rows=t,S.columns=a,S},r.Problem=function(t,a,f){this.distribution=t,this.attacker=a,this.defender=f},r.DistributionBase=function(t,a){this.min=t,this.max=a},r.DistributionBase.prototype.at=function(t){return this[t]||0},r.DistributionBase.prototype.toString=function(){if(this.min===void 0||this.max===void 0)return"no stats";var t="Min: "+this.min+", Max: "+this.max+". ",a=0;t+="[";for(var f=Math.min(this.min,-1);f<=Math.max(this.max,1);++f)f===0&&(t+="| "),t+=S(this.at(f),3)+" ",a+=this.at(f),f===0&&(t+="| ");return t+="]",t+=" "+S(a,3),t+=". "+S(this.downTo(-1),3)+":"+S(this.downTo(1),3),t;function S(k,F){var T=Math.pow(10,F);return Math.round(k*T)/T}},r.DistributionBase.prototype.downTo=function(t){if(t===0)return this.at(t);var a=0;if(t<0)for(var f=this.min;f<=t;f++)a+=this.at(f);else for(var f=t;f<=this.max;f++)a+=this.at(f);return a},r.EmpiricalDistribution=function(){},r.EmpiricalDistribution.prototype=Object.create(r.DistributionBase.prototype),r.EmpiricalDistribution.prototype.increment=function(t){this[t]=this.at(t)+1,this.min===void 0?this.min=t:t<this.min&&(this.min=t),this.max===void 0?this.max=t:this.max<t&&(this.max=t)},r.EmpiricalDistribution.prototype.normalize=function(){for(var t=0,a=this.min;a<=this.max;++a)t+=this.at(a);if(t!==0)for(var a=this.min;a<=this.max;++a)this[a]=this.at(a)/t},r.EnsembleSplit=function(t){this.subproblems={},this.parentProblem=t},r.EnsembleSplit.prototype.increment=function(t,a,f,S,k){if(k!==0){t=t.collapseRanges(f),a=a.collapseRanges(S);var F=this._subproblemKey(t,a);this.subproblems[F]||(this.subproblems[F]=this._problemFactory(t,a)),this.subproblems[F].distribution[f-t.dead()][S-a.dead()]+=k}},r.EnsembleSplit.prototype.getSubproblems=function(){var t=this.subproblems;return Object.keys(this.subproblems).map(function(a){return t[a]})},r.EnsembleSplit.prototype._problemFactory=function(t,a){var f=t.rangesLength(),S=a.rangesLength(),k=r.createMatrix(this.parentProblem.distribution.rows-f,this.parentProblem.distribution.columns-S,0),F=h(this.parentProblem.attacker,t.ranges),T=h(this.parentProblem.defender,a.ranges);return new r.Problem(k,F,T);function h(P,E){for(var j=!0,x=0;x<E.length/2;++x)if(!isNaN(E[x*2])){j=!1;break}if(j)return P;for(var z=P.slice(),x=E.length/2-1;0<=x;--x)isNaN(E[x*2])||z.splice(E[x*2],E[x*2+1]-E[x*2]||1);return z}},r.EnsembleSplit.prototype._subproblemKey=function(t,a){return"a"+t.rangesKey()+"d"+a.rangesKey()},r.Victim=function(){this.ranges=[]},r.Victim.prototype.addRange=function(t,a){var f=this.ranges;if(!isNaN(t)&&t!==a){if(f.length){if(f[f.length-1]===t){f[f.length-1]=a===void 0?t+1:a;return}if(f[f.length-1]===void 0&&f[f.length-2]+1===t){a===void 0?f[f.length-1]=t+1:f[f.length-1]=a;return}}t+1===a?this.ranges.push(t,void 0):this.ranges.push(t,a)}},r.Victim.prototype.rangesLength=function(){for(var t=0,a=0;a<this.ranges.length/2;++a)t+=f(this.ranges,a);return t;function f(S,k){var F=k*2;return isNaN(S[F])?0:isNaN(S[F+1])?1:S[F+1]-S[F]}},r.Victim.prototype.dead=function(){return this._dead!==void 0?this._dead:this.rangesLength()},r.Victim.prototype.collapseRanges=function(t){var a=this.ranges;if(a.length&&(a[a.length-1]===t||a[a.length-1]===void 0&&a[a.length-2]+1===t)){var f;return f=new r.Victim,f.ranges=a.slice(0,a.length-2),f._dead=this.rangesLength(),f}return this},r.Victim.prototype.rangesKey=function(){for(var t=[],a=0;a<this.ranges.length/2;++a)t.push(this.ranges[a*2]+(this.ranges[a*2+1]===void 0?"":"-"+this.ranges[a*2+1]));return t.join(",")},r.Victim.Null=new r.Victim,r.binarySearch=function(t,a,f){for(var S=0,k=t.length-1;S<=k;){var F=k+S>>1,T=f(a,t[F]);if(T>0)S=F+1;else if(T<0)k=F-1;else return F}return-S-1}})(I)}(ie)),ie}var Ae={},ce;function de(){return ce||(ce=1,function(I){(function(r){r.dieSides=10,r.BattleType={Space:"Space",Ground:"Ground"},r.BattleSide={attacker:"attacker",defender:"defender",opponent:function(k){return{attacker:"defender",defender:"attacker"}[k]}},r.SideUnits={attacker:"attackerUnits",defender:"defenderUnits"};var t={Flagship:"Flagship",WarSun:"WarSun",Dreadnought:"Dreadnought",Cruiser:"Cruiser",Carrier:"Carrier",Destroyer:"Destroyer",Fighter:"Fighter",Ground:"Ground",PDS:"PDS"};r.UnitType=t;var a={Flagship:"X",WarSun:"W",Dreadnought:"D",Cruiser:"C",Destroyer:"+",Carrier:"V",Fighter:"F",Ground:"G",PDS:"P"};r.Race={Arborec:"Arborec",Creuss:"Creuss",Hacan:"Hacan",JolNar:"JolNar",L1Z1X:"L1Z1X",Letnev:"Letnev",Mentak:"Mentak",Muaat:"Muaat",Naalu:"Naalu",Saar:"Saar",Sardakk:"Sardakk",Sol:"Sol",Virus:"Virus",Winnu:"Winnu",Xxcha:"Xxcha",Yin:"Yin",Yssaril:"Yssaril"},r.RacesDisplayNames={Arborec:"Arborec",Creuss:"Creuss",Hacan:"Hacan",JolNar:"Jol-Nar",L1Z1X:"L1Z1X",Letnev:"Letnev",Mentak:"Mentak",Muaat:"Muaat",Naalu:"Naalu",Virus:"Nekro Virus",Saar:"Saar",Sardakk:"Sardakk N'orr",Sol:"Sol",Winnu:"Winnu",Xxcha:"Xxcha",Yin:"Yin",Yssaril:"Yssaril"};function f(k,F,T){this.title=k,this.description=F,this.limitedTo=T}f.prototype.availableFor=function(k){return this.limitedTo===void 0||this.limitedTo===k},r.ActionCards={moraleBoost:new f("Morale Boost 1st round","+1 dice modifier to all units during the first battle round"),fireTeam:new f("Fire Team 1st round","Reroll dice after first round of invasion combat"),fighterPrototype:new f("Fighter Prototype","+2 dice modifier to Fighters during the first battle round"),bunker:new f("Bunker","-4 dice modifier to Bombardment rolls","defender"),experimentalBattlestation:new f("Experimental Battlestation","Additional unit with Space Cannon 5(x3)"),maneuveringJets:new f("Maneuvering Jets","Cancel 1 Space Cannon hit"),riskDirectHit:new f("Risk Direct Hit","Damage units vulnerable to Direct Hit before killing off fodder")},r.Technologies={antimassDeflectors:new f("Antimass Deflectors","-1 to opponents' Space Cannon rolls"),gravitonLaser:new f("Graviton Laser System","Space Cannon hits should be applied to non-fighters if possible"),plasmaScoring:new f("Plasma Scoring","One additional die for one unit during Space Cannon or Bombardment"),magenDefense:new f("Magen Defense Grid","Opponent doesn't throw dice for one round if you have Planetary Shield","defender"),x89Omega:new f("X-89 Bacterial Weapon Ω","Destroy all by bombardment if at least one destroyed","attacker"),magenDefenseOmega:new f("Magen Defense Grid Ω","1 hit at the start of ground combat when having structures","defender"),hasDock:new f("Has Dock","Defender has a dock for Magen Defence Grid Ω","defender"),duraniumArmor:new f("Duranium Armor","After each round repair 1 unit that wasn't damaged this round"),assaultCannon:new f("Assault Cannon","Opponent destroys 1 non-Fighter ship if you have at least 3 non-Fighters")},r.Agendas={publicizeSchematics:new f("Publicize Weapon Schematics","WarSuns don't sustain damage"),conventionsOfWar:new f("Conventions of War","No bombardment","defender"),prophecyOfIxth:new f("Prophecy of IXTH","+1 to Fighters rolls")},r.Promissory={letnevMunitionsFunding:new f("Munitions Reserves / War Funding 1st round","Reroll dice during first space combat round"),tekklarLegion:new f("Tekklar Legion","+1 in invasion combat. -1 to Sardakk if he's the opponent")},r.RaceSpecificTechnologies={Letnev:{nonEuclidean:new f("Non-Euclidean Shielding","Sustain Damage absorbs 2 hits"),l4Disruptors:new f("L4 Disruptors","During an Invasion units cannot use Space Cannon against you","attacker")},Sardakk:{valkyrieParticleWeave:new f("Valkyrie Particle Weave","If opponent produces at least one hit in Ground combat, you produce one additional hit")}},r.UnitInfo=function(){function k(F,T){this.type=F;var h=a[this.type];this.shortType=T.isDamageGhost?h.toLowerCase():h,this.battleValue=T.battleValue||NaN,this.battleDice=T.battleDice!==void 0?T.battleDice:1,this.bombardmentValue=T.bombardmentValue||NaN,this.bombardmentDice=T.bombardmentDice||0,this.spaceCannonValue=T.spaceCannonValue||NaN,this.spaceCannonDice=T.spaceCannonDice||0,this.barrageValue=T.barrageValue||NaN,this.barrageDice=T.barrageDice||0,this.sustainDamageHits=T.sustainDamageHits||0,this.isDamageGhost=T.isDamageGhost||!1,this.damageCorporeal=void 0,this.damaged=!1,this.damagedThisRound=!1,this.race=T.race,this.cost=T.cost}return k.prototype.clone=function(){return new k(this.type,this)},k.prototype.toDamageGhost=function(){var F=new k(this.type,{sustainDamageHits:this.sustainDamageHits,battleDice:0,isDamageGhost:!0});return F.damageCorporeal=this,this.damaged=!1,this.damagedThisRound=!1,F},k}(),r.ThrowType={Battle:"battle",Bombardment:"bombardment",SpaceCannon:"spaceCannon",Barrage:"barrage"},r.ThrowValues={battle:"battleValue",bombardment:"bombardmentValue",spaceCannon:"spaceCannonValue",barrage:"barrageValue"},r.ThrowDice={battle:"battleDice",bombardment:"bombardmentDice",spaceCannon:"spaceCannonDice",barrage:"barrageDice"},r.StandardUnits={WarSun:new r.UnitInfo(t.WarSun,{sustainDamageHits:1,battleValue:3,battleDice:3,bombardmentValue:3,bombardmentDice:3,cost:12}),Dreadnought:new r.UnitInfo(t.Dreadnought,{sustainDamageHits:1,battleValue:5,bombardmentValue:5,bombardmentDice:1,cost:4}),Cruiser:new r.UnitInfo(t.Cruiser,{battleValue:7,cost:2}),Carrier:new r.UnitInfo(t.Carrier,{battleValue:9,cost:3}),Destroyer:new r.UnitInfo(t.Destroyer,{battleValue:9,barrageValue:9,barrageDice:2,cost:1}),Fighter:new r.UnitInfo(t.Fighter,{battleValue:9,cost:.5}),PDS:new r.UnitInfo(t.PDS,{spaceCannonValue:6,spaceCannonDice:1}),Ground:new r.UnitInfo(t.Ground,{battleValue:8,cost:.5}),ExperimentalBattlestation:new r.UnitInfo("Bloodthirsty Space Dock",{spaceCannonValue:5,spaceCannonDice:3})},r.RaceSpecificUnits={Sardakk:{Flagship:new r.UnitInfo(t.Flagship,{sustainDamageHits:1,battleValue:6,battleDice:2,race:r.Race.Sardakk,cost:8}),Dreadnought:new r.UnitInfo(t.Dreadnought,{sustainDamageHits:1,battleValue:5,bombardmentValue:4,bombardmentDice:2,cost:4})},JolNar:{Flagship:new r.UnitInfo(t.Flagship,{sustainDamageHits:1,battleValue:6,battleDice:2,race:r.Race.JolNar,cost:8})},Winnu:{Flagship:new r.UnitInfo(t.Flagship,{sustainDamageHits:1,battleValue:7,battleDice:void 0,race:r.Race.Winnu,cost:8})},Xxcha:{Flagship:new r.UnitInfo(t.Flagship,{sustainDamageHits:1,battleValue:7,battleDice:2,spaceCannonValue:5,spaceCannonDice:3,race:r.Race.Xxcha,cost:8})},Yin:{Flagship:new r.UnitInfo(t.Flagship,{sustainDamageHits:1,battleValue:9,battleDice:2,race:r.Race.Yin,cost:8})},Yssaril:{Flagship:new r.UnitInfo(t.Flagship,{sustainDamageHits:1,battleValue:5,battleDice:2,race:r.Race.Yssaril,cost:8})},Sol:{Flagship:new r.UnitInfo(t.Flagship,{sustainDamageHits:1,battleValue:5,battleDice:2,race:r.Race.Sol,cost:8}),Ground:new r.UnitInfo(t.Ground,{battleValue:7,cost:.5})},Creuss:{Flagship:new r.UnitInfo(t.Flagship,{sustainDamageHits:1,battleValue:5,battleDice:1,race:r.Race.Creuss,cost:8})},L1Z1X:{Flagship:new r.UnitInfo(t.Flagship,{sustainDamageHits:1,battleValue:5,battleDice:2,race:r.Race.L1Z1X,cost:8})},Mentak:{Flagship:new r.UnitInfo(t.Flagship,{sustainDamageHits:1,battleValue:7,battleDice:2,race:r.Race.Mentak,cost:8})},Naalu:{Flagship:new r.UnitInfo(t.Flagship,{sustainDamageHits:1,battleValue:9,battleDice:2,race:r.Race.Naalu,cost:8}),Fighter:new r.UnitInfo(t.Fighter,{battleValue:8,cost:.5})},Virus:{Flagship:new r.UnitInfo(t.Flagship,{sustainDamageHits:1,battleValue:9,battleDice:2,race:r.Race.Virus,cost:8})},Arborec:{Flagship:new r.UnitInfo(t.Flagship,{sustainDamageHits:1,battleValue:7,battleDice:2,race:r.Race.Arborec,cost:8})},Letnev:{Flagship:new r.UnitInfo(t.Flagship,{sustainDamageHits:1,battleValue:5,battleDice:2,bombardmentValue:5,bombardmentDice:3,race:r.Race.Letnev,cost:8})},Saar:{Flagship:new r.UnitInfo(t.Flagship,{sustainDamageHits:1,battleValue:5,battleDice:2,barrageValue:6,barrageDice:4,race:r.Race.Saar,cost:8})},Muaat:{Flagship:new r.UnitInfo(t.Flagship,{sustainDamageHits:1,battleValue:5,battleDice:2,race:r.Race.Muaat,cost:8})},Hacan:{Flagship:new r.UnitInfo(t.Flagship,{sustainDamageHits:1,battleValue:7,battleDice:2,race:r.Race.Hacan,cost:8})}},r.StandardUpgrades={Dreadnought:new r.UnitInfo(t.Dreadnought,{sustainDamageHits:1,battleValue:5,bombardmentValue:5,bombardmentDice:1,cost:4}),Cruiser:new r.UnitInfo(t.Cruiser,{battleValue:6,cost:2}),Destroyer:new r.UnitInfo(t.Destroyer,{battleValue:8,barrageValue:6,barrageDice:3,cost:1}),Fighter:new r.UnitInfo(t.Fighter,{battleValue:8,cost:.5}),PDS:new r.UnitInfo(t.PDS,{spaceCannonValue:5,spaceCannonDice:1}),Ground:new r.UnitInfo(t.Ground,{battleValue:7,cost:.5})},r.RaceSpecificUpgrades={Sol:{Carrier:new r.UnitInfo(t.Carrier,{sustainDamageHits:1,battleValue:9,cost:3}),Ground:new r.UnitInfo(t.Ground,{battleValue:6,cost:.5})},L1Z1X:{Dreadnought:new r.UnitInfo(t.Dreadnought,{sustainDamageHits:1,battleValue:4,bombardmentValue:4,bombardmentDice:1,cost:4})},Naalu:{Fighter:new r.UnitInfo(t.Fighter,{battleValue:7,cost:.5})},Muaat:{WarSun:new r.UnitInfo(t.WarSun,{sustainDamageHits:1,battleValue:3,battleDice:3,bombardmentValue:3,bombardmentDice:3,cost:10})}},r.MergedUnits={},r.MergedUpgrades={};for(var S in r.Race)r.MergedUnits[S]=Object.assign({},r.StandardUnits,r.RaceSpecificUnits[S]),r.MergedUpgrades[S]=Object.assign({},r.StandardUpgrades,r.RaceSpecificUpgrades[S]);r.expandFleet=function(k,F){var T=k.options||{attacker:{},defender:{}},h=k.battleType,P=T[F],E=r.BattleSide.opponent(F),j=T[E],x=r.MergedUnits[P.race],z=r.MergedUpgrades[P.race],te=h===r.BattleType.Space&&j.race===r.Race.Mentak&&(k[r.SideUnits[E]][t.Flagship]||{count:0}).count!==0,L=[],N=k[r.SideUnits[F]];for(var X in t)for(var ee=N[X]||{count:0},Q=0;Q<ee.count;Q++){var O=(ee.upgraded?z:x)[X],ae=O.clone();L.push(ae),O.sustainDamageHits>0&&!te&&!(X===t.WarSun&&P.publicizeSchematics)&&(Q<ee.count-(ee.damaged||0)?L.push(ae.toDamageGhost()):ae.damaged=!0)}var ne=H(),_=h===r.BattleType.Space&&P.race===r.Race.Virus&&(N[t.Flagship]||{count:0}).count!==0,D=h===r.BattleType.Ground&&P.race===r.Race.Naalu&&(N[t.Flagship]||{count:0}).count!==0,B=R(_),U={};U[t.Ground]=1,U[t.Fighter]=2;var C,V;return D?(V=(N[t.Fighter]||{}).upgraded&&!(N[t.Ground]||{}).upgraded&&L.find(function(n){return n.type===t.Ground}),C=q):(N[t.Dreadnought]||{}).upgraded?C=Y:C=Z,L.sort(C),h===r.BattleType.Space&&P.experimentalBattlestation&&L.push(r.StandardUnits.ExperimentalBattlestation),L.comparer=C,L.filterForBattle=e,L;function H(){return[t.Flagship,t.WarSun,t.Dreadnought,t.Cruiser,t.Destroyer,t.Carrier,t.Fighter]}function R(n){var A=[],s=0;for(var i in t)A[i]=s++;if(n){var c=A[t.Ground];A[t.Ground]=A[t.Fighter],A[t.Fighter]=c}return A}function Z(n,A){var s=B[n.type]-B[A.type],i=(n.isDamageGhost?1:0)-(A.isDamageGhost?1:0),c=(A.damaged?1:0)-(n.damaged?1:0);if(P.riskDirectHit){var l=i*1e3+s*10+c;return P.race!==r.Race.Letnev?l:n.type===t.Flagship&&n.isDamageGhost?A.type===t.Flagship&&A.isDamageGhost?0:1:A.type===t.Flagship&&A.isDamageGhost?-1:l}else return s*1e3+i*10+c}function Y(n,A){return P.riskDirectHit?Z(n,A):n.type===t.Dreadnought&&n.isDamageGhost?A.type===t.Dreadnought&&A.isDamageGhost?0:1:A.type===t.Dreadnought&&A.isDamageGhost?-1:Z(n,A)}function q(n,A){var s=U[n.type]-U[A.type];return V?n===V?-1:A===V?1:-s:s}function e(){var n=this.filter(function(A){return h===r.BattleType.Space?ne.indexOf(A.type)>=0||_&&A.type===r.UnitType.Ground:A.type===t.Ground||D&&A.type===r.UnitType.Fighter});return n.comparer=this.comparer,n}},r.upgradeable=function(k,F){return!!(r.StandardUpgrades.hasOwnProperty(F)||r.RaceSpecificUpgrades[k]&&r.RaceSpecificUpgrades[k].hasOwnProperty(F))},r.damageable=function(k,F,T){return(T?r.MergedUpgrades:r.MergedUnits)[k][F].sustainDamageHits>0}})(I)}(Ae)),Ae}(function(I){(function(r){var t,a;typeof oe=="function"?(t=he(),a=de()):(t=window,a=window),r.calculator=function(){var f=ee(),S=N();return{computeProbabilities:k};function k(e){var n=e.battleType,A=e.options||{attacker:{},defender:{}},s=a.expandFleet(e,a.BattleSide.attacker),i=a.expandFleet(e,a.BattleSide.defender),c=s.filterForBattle(),l=i.filterForBattle(),u=t.createMatrix(c.length+1,l.length+1,0);u[c.length][l.length]=1;var d=[new t.Problem(u,c,l)],g=S;if(A.attacker.race===a.Race.Mentak){g=S.slice();var o=g[1];if(g[1]=g[2],g[2]=o,g[1].name!=="Mentak racial"||g[2].name!=="Assault Cannon")throw new Error("unexpected pre-battle actions order")}g.forEach(function(v){v.appliesTo===n&&(d=v.execute(d,s,i,A))});for(var y=0;y<d.length;++y)d[y].attacker.length&&d[y].defender.length&&F(d[y],n,s,i,A);var p=new t.DistributionBase(-c.length,l.length),b=c.map(function(v){return[v.shortType]}),w=l.map(function(v){return[v.shortType]});return d.forEach(function(v){p[0]=p.at(0)+v.distribution[0][0];for(var m=1;m<v.distribution.rows;m++)p[-m]=p.at(-m)+v.distribution[m][0],b[m-1].indexOf(v.attacker[m-1].shortType)<0&&b[m-1].push(v.attacker[m-1].shortType);for(var W=1;W<v.distribution.columns;W++)p[W]=p.at(W)+v.distribution[0][W],w[W-1].indexOf(v.defender[W-1].shortType)<0&&w[W-1].push(v.defender[W-1].shortType)}),{distribution:p,attacker:b.map(function(v){return v.reduce(function(m,W){return m+W})}),defender:w.map(function(v){return v.reduce(function(m,W){return m+W})})}}function F(e,n,A,s,i){var c=X(n,i.attacker,i.defender,e.attacker,!0),l=X(n,i.defender,i.attacker,e.defender,!0),u=n===a.BattleType.Ground&&i.attacker.fireTeam||n===a.BattleType.Space&&i.attacker.letnevMunitionsFunding,d=n===a.BattleType.Ground&&i.defender.fireTeam||n===a.BattleType.Space&&i.defender.letnevMunitionsFunding,g=n===a.BattleType.Ground&&i.defender.magenDefense&&s.some(R(a.UnitType.PDS))&&!A.some(R(a.UnitType.WarSun)),o={valkyrieParticleWeave:n===a.BattleType.Ground,winnuFlagship:n===a.BattleType.Space};if(n===a.BattleType.Ground&&i.defender.magenDefenseOmega&&(i.defender.hasDock||s.some(R(a.UnitType.PDS)))){var y=O([1],e.attacker.length+1),p=O([0,1],e.defender.length);p.unshift([1]),L(e,y,p,i)}if(c!==void 0||l!==void 0||g||u||d){var b;g?b=function(){return O([1],e.attacker.length+1)}:b=function(){return h(e.attacker,a.ThrowType.Battle,c,u)};var w=function(){return h(e.defender,a.ThrowType.Battle,l,d)};if(i.attacker.race===a.Race.L1Z1X&&n===a.BattleType.Ground){var v=e.distribution[0];e.distribution[0]=new Array(e.distribution.columns),e.distribution[0].fill(0),L(e,b,w,i,o),S.find(function(W){return W.name==="Bombardment"}).execute([e],A,s,i);for(var m=0;m<e.distribution.columns;++m)e.distribution[0][m]+=v[m]}else L(e,b,w,i,o);n===a.BattleType.Space&&H(e,i)}if(g&&(c!==void 0||u)){var b=function(){return h(e.attacker,a.ThrowType.Battle,c,u)},w=function(){return h(e.defender,a.ThrowType.Battle,X(n,i.defender,i.attacker,e.defender,!1))};L(e,b,w,i,o)}T(e,n,A,s,i)}function T(e,n,A,s,i){var c=e.distribution,l=h(e.attacker,a.ThrowType.Battle,X(n,i.attacker,i.defender,e.attacker,!1)),u=h(e.defender,a.ThrowType.Battle,X(n,i.defender,i.attacker,e.defender,!1));if(i.attacker.race===a.Race.L1Z1X&&n===a.BattleType.Ground){var d=ae(A,s,i);d.length===1&&(d=void 0)}else var d=void 0;for(var g=n===a.BattleType.Space&&(i.attacker.race===a.Race.Winnu&&e.attacker.some(R(a.UnitType.Flagship))||i.defender.race===a.Race.Winnu&&e.defender.some(R(a.UnitType.Flagship))),o=i.attacker.race===a.Race.Yin?q(e.attacker,R(a.UnitType.Flagship))+1:0,y=i.defender.race===a.Race.Yin?q(e.defender,R(a.UnitType.Flagship))+1:0,p=c.rows-1;0<p;p--)for(var b=c.columns-1;0<b;b--){g&&(i.attacker.race===a.Race.Winnu&&V(e.attacker,e.defender,b)&&(l=h(e.attacker,a.ThrowType.Battle,X(n,i.attacker,i.defender,e.attacker,!1))),i.defender.race===a.Race.Winnu&&V(e.defender,e.attacker,p)&&(u=h(e.defender,a.ThrowType.Battle,X(n,i.defender,i.attacker,e.defender,!1))));var w=_(l[p],e.defender,b-1,i.defender),v=_(u[b],e.attacker,p-1,i.attacker),m=x(w,v,b+1,p+1);n===a.BattleType.Ground&&(m=D(m,i,b+1,p+1)),d&&(m=te(m,d,b+1,p+1));var W;if(c[p][b]!==0){W=c[p][b]/(1-m.at(0,0));for(var G=0;G<m.rows;G++)for(var M=0;M<m.columns&&M<=p;M++)if(!(G===0&&M===0)){var K=p-M,$=b-G;(K<o||$<y)&&(K=$=0),c[K][$]+=m.at(G,M)*W}c[p][b]=0}}}function h(e,n,A,s){A=A||0;for(var i=[[1]],c=1;c<=e.length;++c){var l=e[c-1],u=E(l,n,A,s);i.push(j(u,i[c-1]))}return i}function P(e,n,A,s){for(var i=[[1]],c=[[1]],l=0;l<e.length;l++){var u=e[l];if(A(u)){var d=E(u,n,s);c=j(c,d)}i.push(c)}return i}function E(e,n,A,s){var i=e[a.ThrowValues[n]],c=e[a.ThrowDice[n]];if(c===0)return[1];A=A||0;var l=typeof A=="function"?A:function(m){return A},u=[],d=Math.max(Math.min((i-1-l(e))/a.dieSides,1),0);if(e.type===a.UnitType.Flagship&&e.race===a.Race.JolNar&&n===a.ThrowType.Battle){var g=1-d,o=Math.min(.8,d),y=Math.max(0,g-.2),p=Math.max(0,.2-g),b=Math.min(.2,g);u[0]=o*(s?o:1),u[1]=y+(s?d*y:0),u[2]=p+(s?d*p:0),u[3]=b+(s?d*b:0)}else u[0]=d,s&&(u[0]=u[0]*u[0]),u[1]=1-u[0];for(var w=u,v=1;v<c;v++)w=j(w,u);return w}function j(e,n){for(var A=[],s=0;s<e.length+n.length-1;++s)A[s]=0;for(var i=0;i<e.length;++i)for(var c=0;c<n.length;++c)A[i+c]+=e[i]*n[c];return A}function x(e,n,A,s){return{rows:Math.min(A,e.length),columns:Math.min(s,n.length),at:function(i,c){var l=e[i];if(i===A-1)for(;++i<e.length;)l+=e[i];var u=n[c];if(c===s-1)for(;++c<n.length;)u+=n[c];return l*u}}}function z(e,n){return{rows:e.length,columns:n.length,at:function(A,s){return e[A]*n[s]}}}function te(e,n,A,s){return!n||n.length===1?e:B({rows:e.rows+n.length-1,columns:e.columns,at:function(i,c){for(var l=0,u=0;u<=i&&u<n.length;++u)if(i-u<e.rows){var d=n[u];l+=d*e.at(i-u,c)}return l}},A,s)}function L(e,n,A,s,i){var c=e.distribution;i&&!(i.winnuFlagship&&s.attacker.race===a.Race.Winnu)&&(n=n()),i&&!(i.winnuFlagship&&s.defender.race===a.Race.Winnu)&&(A=A()),i=i||{};for(var l=0;l<c.rows;l++)for(var u=0;u<c.columns;u++)if(c[l][u]!==0){var d=n,g=A;i.winnuFlagship&&(s.attacker.race===a.Race.Winnu&&(V(e.attacker,e.defender,u),d=n()),s.defender.race===a.Race.Winnu&&(V(e.defender,e.attacker,l),g=A()));var o=_(d[l],e.defender,u-1,s.defender),y=_(g[u],e.attacker,l-1,s.attacker),p=x(o,y,u+1,l+1);i.valkyrieParticleWeave&&(p=D(p,s,u+1,l+1));for(var b=0;b<p.rows;b++)for(var w=0;w<p.columns;w++)b===0&&w===0||(c[l-w][u-b]+=p.at(b,w)*c[l][u]);c[l][u]*=p.at(0,0)}}function N(){return[{name:"Space Cannon -> Ships",appliesTo:a.BattleType.Space,execute:function(e,n,A,s){var i=[],c=s.attacker.race===a.Race.Virus&&n.some(R(a.UnitType.Flagship))&&n.some(R(a.UnitType.Ground)),l=s.defender.race===a.Race.Virus&&A.some(R(a.UnitType.Flagship))&&A.some(R(a.UnitType.Ground));return e.forEach(function(o){var y=u(n,s.attacker,s.defender),p=u(A,s.defender,s.attacker);if(s.attacker.gravitonLaser||s.defender.gravitonLaser||c||l){for(var b=new t.EnsembleSplit(o),w=o.distribution,v=0;v<w.rows;v++)for(var m=0;m<w.columns;m++)if(w[v][m]!==0)for(var W=z(y,p),G=0;G<W.rows;G++)for(var M=0;M<W.columns;M++){var K=g(o.attacker,v,M,s.attacker,s.defender),$=g(o.defender,m,G,s.defender,s.attacker);b.increment(K,$,v,m,W.at(G,M)*w[v][m])}var J=b.getSubproblems();J.forEach(function(De){H(De,s,o)}),i.push.apply(i,J)}else{var re=O(y,o.attacker.length+1),ke=O(p,o.defender.length+1);L(o,re,ke,s),H(o,s),i.push(o)}}),i;function u(o,y,p){var b=p.antimassDeflectors?-1:0,w=o.filter(d),v;return y.plasmaScoring?v=ne(w,a.ThrowType.SpaceCannon,b):v=Q(w,a.ThrowType.SpaceCannon,b),C(v,p.maneuveringJets?1:0)}function d(o){return o.spaceCannonDice!==0}function g(o,y,p,b,w){if(p===0||y===0)return t.Victim.Null;if(!w.gravitonLaser&&!b.nonEuclidean&&!o.some(R(a.UnitType.Ground))){var M=new t.Victim;return M._dead=Math.min(p,o.map(K).reduce($)),M}for(var v=[],G=null,m=y-1;0<=m&&0<p;){var W=o[m];W.type===a.UnitType.Fighter&&w.gravitonLaser||W.type===a.UnitType.Ground?G=null:(G===null&&(G=[m+1,m+1],v.push(G)),G[0]--,p-=K(W)),m--}var G=null;if(w.gravitonLaser)for(var m=y-1;0<=m&&0<p;--m)o[m].type===a.UnitType.Fighter&&(G===null&&(G=[m+1,m+1],v.push(G)),G[0]--,p-=K(o[m]));v.sort(function(J,re){return J[0]-re[0]});var M=new t.Victim;return v.forEach(function(J){M.addRange(J[0],J[1])}),M;function K(J){return J.isDamageGhost&&b.nonEuclidean?2:1}function $(J,re){return J+re}}}},{name:"Assault Cannon",appliesTo:a.BattleType.Space,execute:function(e,n,A,s){if(!s.attacker.assaultCannon&&!s.defender.assaultCannon)return e;var i=[];return e.forEach(function(u){for(var d=new t.EnsembleSplit(u),g=c(u.attacker,s.attacker.assaultCannon),o=c(u.defender,s.defender.assaultCannon),y=l(u.attacker,o<u.defender.length,!0),p=l(u.defender,g<u.attacker.length,!1),b=u.distribution,w=0;w<b.rows;w++)for(var v=0;v<b.columns;v++)if(b[w][v]!==0){var m=o<v?y[w]:t.Victim.Null,W=g<w?p[v]:t.Victim.Null;d.increment(m,W,w,v,b[w][v])}var G=d.getSubproblems();G.forEach(function(M){H(M,s,u)}),i.push.apply(i,G)}),i;function c(u,d){for(var g=0,o=0;o<u.length;o++)if(Z(u[o])&&g++,g>=3&&d)return o;return o}function l(u,d,g){var o=new Array(u.length+1);if(!d)o.fill(t.Victim.Null);else{o[0]=t.Victim.Null;for(var y=void 0,p=void 0,b=void 0,w=0;w<u.length;++w){(g?Z:Y)(u[w])?(y=u[w],p=w,b=void 0):y&&u[w].damageCorporeal===y&&(b=w);var v=new t.Victim;p!==void 0&&(v.addRange(p,void 0),b!==void 0&&v.addRange(b,void 0)),o[w+1]=v}}return o}}},{name:"Mentak racial",appliesTo:a.BattleType.Space,execute:function(e,n,A,s){return e.forEach(function(i){if(s.attacker.race!==a.Race.Mentak&&s.defender.race!==a.Race.Mentak)return;function c(d,g){var o=0,y=g.moraleBoost?1:0;return P(d,a.ThrowType.Battle,function(p){return 2<=o?!1:p.type===a.UnitType.Cruiser||p.type===a.UnitType.Destroyer?(o++,!0):!1},y)}var l,u;s.attacker.race===a.Race.Mentak?l=c(i.attacker,s.attacker):l=O([1],i.attacker.length+1),s.defender.race===a.Race.Mentak?u=c(i.defender,s.defender):u=O([1],i.defender.length+1),L(i,l,u,s),H(i,s)}),e}},{name:"Anti-Fighter Barrage",appliesTo:a.BattleType.Space,execute:function(e,n,A,s){var i=[];return e.forEach(function(d){for(var g=new t.EnsembleSplit(d),o=P(d.attacker,a.ThrowType.Barrage,c),y=P(d.defender,a.ThrowType.Barrage,c),p=l(d.attacker,R(a.UnitType.Fighter)),b=l(d.defender,R(a.UnitType.Fighter)),w=d.distribution,v=0;v<w.rows;v++)for(var m=0;m<w.columns;m++)if(w[v][m]!==0)for(var W=z(o[v],y[m]),G=0;G<W.rows;G++)for(var M=0;M<W.columns;M++){var K=u(p,v,M),$=u(b,m,G);g.increment(K,$,v,m,W.at(G,M)*w[v][m])}i.push.apply(i,g.getSubproblems())}),i;function c(d){return d.barrageDice!==0}function l(d,g){for(var o=void 0,y=0;y<d.length;y++)if(o===void 0)g(d[y])&&(o=y);else if(!g(d[y]))break;return o===void 0&&(o=y),{from:o,to:y}}function u(d,g,o){if(o===0||g<d.from)return t.Victim.Null;var y=new t.Victim;return y.addRange(d.from,Math.min(g,d.from+o,d.to)),y}}},{name:"Bombardment",appliesTo:a.BattleType.Ground,execute:function(e,n,A,s){return e.forEach(function(i){var c=ae(n,A,s),l=O(c,i.attacker.length+1),u=O([1],i.defender.length+1);L(i,l,u,s)}),e}},{name:"Space Cannon -> Ground Forces",appliesTo:a.BattleType.Ground,execute:function(e,n,A,s){return e.forEach(function(i){if(!s.attacker.l4Disruptors){var c=O([1],i.attacker.length+1),l=s.attacker.antimassDeflectors?-1:0,u=A.filter(R(a.UnitType.PDS)),d;s.defender.plasmaScoring?d=ne(u,a.ThrowType.SpaceCannon,l):d=Q(u,a.ThrowType.SpaceCannon,l);var g=O(C(d,s.attacker.maneuveringJets?1:0),i.defender.length+1);L(i,c,g,s)}}),e}}]}function X(e,n,A,s,i){for(var c=void 0,l=0;l<f.length;l++)if(!(!i&&f[l].firstRoundOnly)){var u=f[l].apply(e,n,A,s);if(u&&!c){c=u;continue}u&&(c=d(c,u))}return c;function d(g,o){var y=typeof g=="function",p=typeof o=="function";return y||p?function(b){return(y?g(b):g)+(p?o(b):o)}:g+o}}function ee(){return[{name:"moraleBoost",firstRoundOnly:!0,apply:function(e,n){return n.moraleBoost?1:0}},{name:"fighterPrototype",firstRoundOnly:!0,apply:function(e,n){return e===a.BattleType.Space&&n.fighterPrototype?function(A){return A.type===a.UnitType.Fighter?2:0}:0}},{name:"Sardakk",firstRoundOnly:!1,apply:function(e,n){return n.race===a.Race.Sardakk?1:0}},{name:"Sardakk Flagship",firstRoundOnly:!1,apply:function(e,n,A,s){return n.race===a.Race.Sardakk&&e===a.BattleType.Space&&s.some(R(a.UnitType.Flagship))?function(i){return i.type!==a.UnitType.Flagship?1:0}:0}},{name:"JolNar",firstRoundOnly:!1,apply:function(e,n){return n.race===a.Race.JolNar?-1:0}},{name:"prophecyOfIxth",firstRoundOnly:!1,apply:function(e,n){return n.prophecyOfIxth?function(A){return A.type===a.UnitType.Fighter?1:0}:0}},{name:"tekklarLegion",firstRoundOnly:!1,apply:function(e,n){return e===a.BattleType.Ground&&n.tekklarLegion&&n.race!==a.Race.Sardakk?1:0}},{name:"tekklarLegion of the opponent",firstRoundOnly:!1,apply:function(e,n,A){return e===a.BattleType.Ground&&A.tekklarLegion&&n.race===a.Race.Sardakk?-1:0}}]}function Q(e,n,A,s){return h(e,n,A,s).pop()}function O(e,n){var A=new Array(n);return A.fill(e),A}function ae(e,n,A){var s=!A.defender.conventionsOfWar&&(!n.some(R(a.UnitType.PDS))||e.some(R(a.UnitType.WarSun))||A.attacker.race===a.Race.Letnev&&e.some(R(a.UnitType.Flagship)));if(!s)return[1];var i=A.defender.bunker?-4:0,c=e.filter(d),l=A.attacker.plasmaScoring?ne(c,a.ThrowType.Bombardment,i):Q(c,a.ThrowType.Bombardment,i);if(A.attacker.x89Omega){var u=new Array(n.length+1);u.fill(0),u[0]=l[0],u[u.length-1]=l.reduce(function(g,o){return g+o})-l[0],l=u}return l;function d(g){return g.bombardmentDice!==0}}function ne(e,n,A){var s=h(e,n,A).pop(),i=U(e,a.ThrowValues[n]);if(i){var c=i.clone();c[a.ThrowDice[n]]=1;var l=E(c,n,A);s=j(l,s)}return s}function _(e,n,A,s){if(s.nonEuclidean&&e.length>2){for(var i=e.slice(),c=1;c<i.length&&0<A;c++)n[A].isDamageGhost&&C(i,1,c),A--;return i}else return e}function D(e,n,A,s){return!n.attacker.valkyrieParticleWeave&&!n.defender.valkyrieParticleWeave?e:B({rows:e.rows+(n.attacker.valkyrieParticleWeave?1:0),columns:e.columns+(n.defender.valkyrieParticleWeave?1:0),at:function(i,c){if(i===0&&c===0)return e.at(0,0);if(i===0)return n.attacker.valkyrieParticleWeave||c===e.columns?0:e.at(i,c);if(c===0)return n.defender.valkyrieParticleWeave||i===e.rows?0:e.at(i,c);if(i===1&&c===1&&n.attacker.valkyrieParticleWeave&&n.defender.valkyrieParticleWeave)return(e.columns===1?0:e.at(0,1))+(e.rows===1?0:e.at(1,0));if(n.attacker.valkyrieParticleWeave&&n.defender.valkyrieParticleWeave&&(i===e.rows&&c===1||i===1&&c===e.columns))return 0;var l=n.attacker.valkyrieParticleWeave&&!(n.defender.valkyrieParticleWeave&&c===1)?1:0,u=n.defender.valkyrieParticleWeave&&!(n.attacker.valkyrieParticleWeave&&i===1)?1:0;return e.at(i-l,c-u)}},A,s)}function B(e,n,A){return e.rows<=n&&e.columns<=A?e:{rows:Math.min(e.rows,n),columns:Math.min(e.columns,A),at:function(s,i){for(var c=0,l=s===this.rows-1?e.rows:s+1,u=i===this.columns-1?e.columns:i+1,d=s;d<l;++d)for(var g=i;g<u;++g)c+=e.at(d,g);return c}}}function U(e,n){for(var A=null,s=1/0,i=0;i<e.length;i++)e[i][n]<s&&(A=e[i],s=e[i][n]);return A}function C(e,n,A){A=A||0;for(var s=0;s<n;++s){e.length>A+1&&(e[A]+=e[A+1]);for(var i=A+2;i<e.length;i++)e[i-1]=e[i];e.length>A+1&&e.pop()}return e}function V(e,n,A){var s=null;return e.filter(R(a.UnitType.Flagship)).forEach(function(i){i.battleDice=s===null?s=n.slice(0,A).filter(Y).length:s}),s!==null}function H(e,n,A){if(n.attacker.race===a.Race.Yin||n.defender.race===a.Race.Yin){var s=c(e,n,A,a.BattleSide.attacker),i=c(e,n,A,a.BattleSide.defender);l(e.distribution,s,e.distribution.columns),l(e.distribution,e.distribution.rows,i)}function c(u,d,g,o){var y=q(u[o],R(a.UnitType.Flagship));return d[o].race===a.Race.Yin?g&&u[o].length<g[o].length&&y<q(g[o],R(a.UnitType.Flagship))?o===a.BattleSide.attacker?u.distribution.rows:u.distribution.columns:y+1:0}function l(u,d,g){for(var o=0;o<d;++o)for(var y=0;y<g;++y)o===0&&y===0||(u[0][0]+=u[o][y],u[o][y]=0)}}function R(e){return function(n){return n.type===e&&!n.isDamageGhost}}function Z(e){return e.type!==a.UnitType.Fighter&&!e.isDamageGhost}function Y(e){return e.type!==a.UnitType.Fighter&&e.type!==a.UnitType.Ground&&!e.isDamageGhost}function q(e,n){for(var A=e.length-1;0<=A;--A)if(n(e[A]))return A;return-1}}()})(I)})(se);const ge=fe(se),ve="rgba(0, 0, 0, 0.8)",le=[[],[{position:[160,290]}],[{position:[120,20]},{position:[160,380]}],[{position:[150,270]},{position:[190,10]},{position:[200,380]}]],pe=[[256,220],[256,180],[256,220],[256,180]];async function me(){const I=await import("https://www.twilightwars.com/js/api.js"),{skeletonHexArray:r}=await import("https://www.twilightwars.com/js/board-creation.js"),t=await I.getBoardSystems(),a=await I.getPlayers(),f=new Image;f.src="data:image/png;base64,"+ye,await new Promise(S=>{f.onload=S}),t.forEach(async S=>{var F,T,h,P;const k=S.number===51?r[r.length-1]:r[S.position];await be(a,S,f,k),(F=k.userData.boardTokens)==null||F.controlTokens.forEach(E=>{E.visible=!1}),(T=k.userData.boardTokens)==null||T.infantry.forEach(E=>{E.visible=!1}),(h=k.userData.boardTokens)==null||h.pds.forEach(E=>{E.visible=!1}),(P=k.userData.boardTokens)==null||P.spaceDock.forEach(E=>{E.visible=!1}),k.material.map.needsUpdate=!0,k.material.needsUpdate=!0})}const ye="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";async function be(I,r,t,a){var _;const{CanvasTexture:f,Mesh:S,MeshBasicMaterial:k}=await import("https://www.twilightwars.com/js/vendor/three/build/three.module.js"),{createHexagonGeometry:F}=await import("https://www.twilightwars.com/js/utils/geometries.js"),T=document.createElement("canvas"),h=T.getContext("2d"),P=25;T.width=512,T.height=512;const E={Alpha:"red",Beta:"blue",Delta:"green"},j=I.reduce((D,B)=>(D[B.faction]=B.color,D),{}),x={red:"rgba(255, 0, 0, 1.0)",blue:"rgba(0, 0, 255, 1.0)",green:"rgba(0, 255, 0, 1.0)",yellow:"rgba(255, 255, 0, 1.0)",purple:"rgba(255, 0, 255, 1.0)",black:"rgba(0, 0, 0, 1.0)",orange:"rgba(255, 165, 0, 1.0)"},z={red:"rgba(255, 150, 150, 1)",blue:"rgba(150, 150, 255, 1)",green:"rgba(150, 255, 150, 1)",yellow:"rgba(255, 255, 0, 1)",purple:"rgba(255, 150, 255, 1)",orange:"rgba(255, 150, 0, 1)",white:"white"},te=(_=r.units)==null?void 0:_[0],L=te?x[te.color]:null;L&&(h.fillStyle=L,h.fillRect(0,0,T.width,T.height),h.globalCompositeOperation="destination-in",h.drawImage(t,-T.width*.1,-T.height*.1,T.width*1.2,T.height*1.2),h.globalCompositeOperation="source-over");function N(D,B,U,C,V="white",H=!1,R){h.font=`bold ${D}px Arial`;const Z=h.measureText(B).width,Y=U-Z/2;h.fillStyle=V,h.fillText(B,H?Y:U,C),R&&(h.strokeStyle=R,h.lineWidth=2,h.strokeText(B,H?Y:U,C))}function X(D,B,U,C,V,H="white"){h.beginPath(),h.moveTo(D+V,B),h.lineTo(D+U-V,B),h.quadraticCurveTo(D+U,B,D+U,B+V),h.lineTo(D+U,B+C-V),h.quadraticCurveTo(D+U,B+C,D+U-V,B+C),h.lineTo(D+V,B+C),h.quadraticCurveTo(D,B+C,D,B+C-V),h.lineTo(D,B+V),h.quadraticCurveTo(D,B,D+V,B),h.closePath(),h.fillStyle=H,h.fill()}r.anomaly&&N(P*1.5,r.anomaly,256,50,"white",!0);const ee={Alpha:"🔴",Beta:"🔵",Delta:"🟢",Yellow:"🟡"};r.wormhole&&N(P*3.5,ee[r.wormhole]??r.wormhole,256,500,E[r.wormhole],!0),r.commandTokens&&r.commandTokens.forEach((D,B)=>{const U=j[D];h.lineWidth=20,h.beginPath();const C=2*Math.PI/6*B,V=256+226*Math.cos(C),H=256+266*Math.sin(C),R=256+226*Math.cos(C+2*Math.PI/6),Z=256+266*Math.sin(C+2*Math.PI/6);h.moveTo(V,H),h.lineTo(R,Z),h.strokeStyle=U,h.stroke()});for(let D=0;D<6;D++){const B=L??"black";h.lineWidth=5,h.beginPath();const U=2*Math.PI/6*D,C=256+256*Math.cos(U),V=256+296*Math.sin(U),H=256+256*Math.cos(U+2*Math.PI/6),R=256+296*Math.sin(U+2*Math.PI/6);h.moveTo(C,V),h.lineTo(H,R),h.strokeStyle=B,h.stroke()}if(r.planets){let D=0;for(const B of r.planets)ne(B,D++)}const Q=new f(T),O=F(.9),ae=new k({map:Q});new S(O,ae),a.material.onBeforeCompile=function(D){D.uniforms.canvasTexture={value:Q},D.fragmentShader=`
        uniform sampler2D canvasTexture;
      `+D.fragmentShader,D.fragmentShader=D.fragmentShader.replace("gl_FragColor = vec4( outgoingLight, diffuseColor.a );",`
        vec4 tex1Color = texture2D( map, vUv );
        vec4 canvasColor = texture2D( canvasTexture, vUv );
        gl_FragColor = vec4(canvasColor.a * canvasColor.rgb + tex1Color.rgb * (1.0 - canvasColor.a), 1.0);
        `)};function ne(D,B){const U=le[r.planets.length][B].position[0],C=le[r.planets.length][B].position[1],V=I.find(n=>n.planetCards.find(A=>A.name===D.name));function H(n,A,s){const i=V?z[V.color]:"white";h.fillStyle="white",n.filter(l=>l.name==="PDS").forEach((l,u)=>{N(P,"🛡",A+10+u*30,s-25,i)}),n.filter(l=>l.name==="Space Dock").forEach((l,u)=>{N(P,"🏗",A+10+u*30,s,i)});const c=n.some(l=>l.name==="Infantry"&&l.upgraded);N(P,`🥆${c?"+":""}`,A+82,s+35,i),h.font=`bold ${P*2}px Arial`,N(P*2,n.filter(l=>l.name==="Infantry").length.toString(),A+95,s,i,!0)}const R=V?V.planetCards.find(n=>n.name===D.name):null,Z=`${D.resources}/${D.influence}`;let Y,q="";switch(D.tech){case"Warfare":q="🔴";break;case"Biotic":q="🟢";break;case"Cybernetic":Y="white",q="🟡";break;case"Propulsion":Y="white",q="🔵";break}h.font=`bold ${P}px Arial`;const e=h.measureText(Z).width;if(e>0){switch(D.trait){case"Hazardous":h.fillStyle="red";break;case"Industrial":h.fillStyle="green";break;case"Cultural":h.fillStyle="blue";break;default:h.fillStyle="white"}h.fillStyle=Y??"white";const n=V?j[V.faction]:"white";h.font=`bold ${P*2}px Arial`,X(U,C,200,100,10,ve),D.units&&H(D.units,U+80,C+50),N(P*2,Z,U+10,C+50,z[n]),R!=null&&R.exhausted&&(h.lineWidth=5,h.beginPath(),h.moveTo(U+25-e/2,C+30),h.lineTo(U+25+e*1.5,C+30),h.strokeStyle=z[n],h.stroke()),N(P*.9,D.name+q,U+10,C+85,z[n])}}if(r.units){let D=function(U,C,V,H=80){var n;Object.entries(U).length*H;const Z=((n=r.units[0])==null?void 0:n.color)??"white",Y=["Fi","Fi+","In","In+"],q=["🛦","🛦+","🥆","🥆+"],e=[[90,231,331],[90,231,331],[410,231,331],[410,231,331]];for(let A=0;A<Y.length;A++)U[Y[A]]&&(N(P*3,`${q[A]}`,e[A][0],e[A][1],Z,!0,"white"),N(P*3,`${U[Y[A]]?U[Y[A]]:""}`,e[A][0],e[A][2],Z,!0,"white"))};const B=r.units.reduce((U,C)=>{const V=C.upgraded?C.name.slice(0,2)+"+":C.name.slice(0,2);return U[V]=(U[V]||0)+1,U},{});h.font=`bold ${P*2}px Arial`,pe[r.planets.length],D(B)}}async function we(){console.log("running main"),console.log(ge),await me()}we()})();
